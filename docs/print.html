<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>CSCI 4707 lab-book</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="intro.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="machine.html"><strong aria-hidden="true">2.</strong> Connect to CSE Lab machines</a></li><li class="chapter-item expanded "><a href="setup.html"><strong aria-hidden="true">3.</strong> Setup PostgreSQL</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="install.html"><strong aria-hidden="true">3.1.</strong> Installation</a></li><li class="chapter-item expanded "><a href="run.html"><strong aria-hidden="true">3.2.</strong> Run PostgreSQL</a></li><li class="chapter-item expanded "><a href="psql.html"><strong aria-hidden="true">3.3.</strong> PostgreSQL 101</a></li><li class="chapter-item expanded "><a href="troubleshooting.html"><strong aria-hidden="true">3.4.</strong> Troubleshooting</a></li></ol></li><li class="chapter-item expanded "><a href="lab1.html"><strong aria-hidden="true">4.</strong> Lab 1</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="lab1-1.html"><strong aria-hidden="true">4.1.</strong> Part 1: ProjectDB Schema Creation</a></li><li class="chapter-item expanded "><a href="lab1-2.html"><strong aria-hidden="true">4.2.</strong> Part 2: SQL Queries</a></li><li class="chapter-item expanded "><a href="lab1-3.html"><strong aria-hidden="true">4.3.</strong> Part 3: SQL Updates and Deletes</a></li><li class="chapter-item expanded "><a href="lab1-update.html"><strong aria-hidden="true">4.4.</strong> Important updates</a></li><li class="chapter-item expanded "><a href="lab1-submit.html"><strong aria-hidden="true">4.5.</strong> Submit Guidance</a></li></ol></li><li class="chapter-item expanded "><a href="lab2.html"><strong aria-hidden="true">5.</strong> Lab 2</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="lab2-0.html"><strong aria-hidden="true">5.1.</strong> Part 1: Understand Code</a></li><li class="chapter-item expanded "><a href="lab2-1.html"><strong aria-hidden="true">5.2.</strong> Part 2: Implement MRU</a></li><li class="chapter-item expanded "><a href="lab2-2.html"><strong aria-hidden="true">5.3.</strong> Part 3: Compile and Test</a></li><li class="chapter-item expanded "><a href="lab2-submit.html"><strong aria-hidden="true">5.4.</strong> Submit Guidance</a></li></ol></li><li class="chapter-item expanded "><a href="lab3.html"><strong aria-hidden="true">6.</strong> Lab 3</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">CSCI 4707 lab-book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/csci4707-umn/lab-book" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<blockquote>
<p><i class="trigger fa fa-exclamation-triangle fa-lg"></i>
Do <strong>NOT</strong> post your project on a public Github repository.</p>
</blockquote>
<p>This is the online handout for lab assignments for CSCI4707 at UMN. </p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="connect-to-cse-lab-machines"><a class="header" href="#connect-to-cse-lab-machines">Connect to CSE Lab machines</a></h1>
<p>All projects should be able to run on any CSE UNIX/Linux lab machines.</p>
<p>You should have an active CSE Labs Account and be able to connect to the machines. If not, please connect TA <strong>ASAP</strong>. </p>
<p>We recommend to work on the machines listed on this <a href="https://cse.umn.edu/cseit/classrooms-labs">page</a>, for example <code>csel-kh1250-01.cselabs.umn.edu</code>. VOLE is <strong>NOT</strong> recommended for the lab works.</p>
<p>You are free to use any terminal/editor/IDE. I personally recommend to use <a href="https://code.visualstudio.com/">VS code</a> for all labs, as it provides a built-in terminal and allows you to edit files remotely. You can learn how to set up remote editing for VS Code on this <a href="https://www-users.cse.umn.edu/%7Ekauffman/tutorials/unix-environment.html#org07b4b9f">page</a><sup class="footnote-reference"><a href="#1">1</a></sup>.</p>
<p>Useful links:</p>
<ul>
<li><a href="https://www-users.cse.umn.edu/%7Ekauffman/tutorials/unix-environment.html">Accessing Unix/Linux Programming Environments</a><sup class="footnote-reference"><a href="#1">1</a></sup></li>
</ul>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p>Credit to <a href="https://cse.umn.edu/cs/christopher-kauffman">Christopher Kauffman</a></p>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="setup-postgresql"><a class="header" href="#setup-postgresql">Setup PostgreSQL</a></h1>
<p>This chapter includes:</p>
<ol>
<li><a href="./install.html">Install and initialize PostgreSQL</a></li>
<li><a href="./run.html">Run PostgreSQL</a></li>
<li><a href="./psql.html">PostgreSQL 101</a></li>
<li><a href="./troubleshooting.html">Troubleshooting</a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installation"><a class="header" href="#installation">Installation</a></h1>
<p>We first download and install PostgreSQL, then we initialize a folder for PostgreSQL to keep data.</p>
<h2 id="pre-request"><a class="header" href="#pre-request">Pre-request</a></h2>
<ol>
<li>All projects should be able to run on any CSE UNIX/Linux lab machines. You should be able to connect to any CSE UNIX/Linux machines. See detail on this <a href="./machine.html">page</a></li>
<li>PostgreSQL is a large software. You will want at least 200 MB of space in your machine. If not, learn how to free your space on this <a href="https://cse.umn.edu/cseit/self-help-guides/disk-quota-free-your-space">page</a>.</li>
</ol>
<blockquote>
<p>We recommend to work on the machines (with numbers) listed on this <a href="https://cse.umn.edu/cseit/classrooms-labs">page</a>, for example <code>csel-kh1250-01.cselabs.umn.edu</code>. VOLE is <strong>NOT</strong> recommended for the lab works.</p>
</blockquote>
<h2 id="install-postgresql"><a class="header" href="#install-postgresql">Install PostgreSQL</a></h2>
<ol>
<li>Download version 14.1 of PostgreSQL.</li>
</ol>
<pre><code>wget https://ftp.postgresql.org/pub/source/v14.1/postgresql-14.1.tar.gz</code></pre>
<ol start="2">
<li>Extract.</li>
</ol>
<pre><code>tar xvzf postgresql-14.1.tar.gz</code></pre>
<ol start="3">
<li>Create an installation folder, called “install”.</li>
</ol>
<pre><code>mkdir install</code></pre>
<p>Then, we retrieve the full path of both source and installation folder by executing the following command:</p>
<ol start="4">
<li>Retrieve the full path of the directory.</li>
</ol>
<pre><code>pwd</code></pre>
<p>This will return a full path of your current directory. Throughout this documentation, this path is referred as <code>$W$</code>. So, don’t forget to replace it with your actual working directory. Thus, the path of the PostgreSQL’s source code is located at <code>$W$/postgresql-14.1</code> and the path where we will install PostgreSQL is located at <code>$W$/install</code>.</p>
<p>Next, you will configure the installation of PostgreSQL and install PostgreSQL on the given path.</p>
<ol start="5">
<li>Go to the source directory.</li>
</ol>
<pre><code>cd postgresql-14.1</code></pre>
<ol start="6">
<li>Run the configure command. <strong>Don’t forget to change $W$ to your actual directory.</strong></li>
</ol>
<pre><code>./configure --prefix=$W$/install</code></pre>
<ol start="7">
<li>Run the makefile.</li>
</ol>
<pre><code>make</code></pre>
<ol start="8">
<li>Run the installation.</li>
</ol>
<pre><code>make install</code></pre>
<h2 id="initialize-database"><a class="header" href="#initialize-database">Initialize Database</a></h2>
<p>After the installation has finished, you will need to initialize and create a database to use. In this example, we will initialize the database at <code>$W$/install/data</code> folder.</p>
<ol start="9">
<li>Go to the installation folder.</li>
</ol>
<pre><code>cd ../install</code></pre>
<ol start="10">
<li>Initialize database store.</li>
</ol>
<pre><code>bin/initdb -D data</code></pre>
<p>Once the database has been initialized, we can start the PostgreSQL backend.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="run-postgresql"><a class="header" href="#run-postgresql">Run PostgreSQL</a></h1>
<p>PostgreSQL takes a classic <em>server-client</em> architecture. Therefore, we need two terminal windows to start the server and client separately. Let's call them <code>Terminal S</code> (for server) and <code>Terminal C</code> (for client) respectively.</p>
<h2 id="first-time-start-the-server-and-open-the-client"><a class="header" href="#first-time-start-the-server-and-open-the-client">First time start the server and open the client</a></h2>
<h4 id="terminal-s"><a class="header" href="#terminal-s">Terminal S</a></h4>
<ol>
<li>Make sure you are in the installation folder<code>$W$/install</code>.</li>
</ol>
<pre><code>cd $W$/install</code></pre>
<ol start="2">
<li>Start the server</li>
</ol>
<pre><code>bin/postgres -D data</code></pre>
<p>You should see the following output.
<img src="./figure/server.png" alt="server" />
It will keep printing out logs in this terminal. We can use this terminal to get information on what is happening in our DBMS.</p>
<h4 id="terminal-c"><a class="header" href="#terminal-c">Terminal C</a></h4>
<p>To open the client, open another terminal and use the following command to create a database to use: (In this example, we call the database <code>ProjectDB</code>)</p>
<ol>
<li>Make sure you are in the installation folder<code>$W$/install</code>.</li>
</ol>
<pre><code>cd $W$/install</code></pre>
<ol start="2">
<li>Create the ProjectDB database.</li>
</ol>
<pre><code>bin/createdb ProjectDB</code></pre>
<p>We interact with our DBMS by using a program called <code>psql</code>.</p>
<ol start="3">
<li>Open <code>psql</code></li>
</ol>
<pre><code>bin/psql ProjectDB</code></pre>
<p>You should see the following output.
<img src="./figure/client.png" alt="client" />
You can then type and run sql in this program.</p>
<h2 id="shut-down-the-server"><a class="header" href="#shut-down-the-server">Shut down the server</a></h2>
<p>It is a good habit to shut down the server every time you stop working on the lab. To shut down the server, go to <code>Terminal S</code> and shut it down with <code>ctrl-c</code>.</p>
<h2 id="run-postgresql-next-time"><a class="header" href="#run-postgresql-next-time">Run PostgreSQL next time</a></h2>
<p>The next time you want to start the database again, you only need to run two terminals and start the server and client again.</p>
<ol>
<li>Make sure you are in the installation folder<code>$W$/install</code>.</li>
</ol>
<pre><code>cd $W$/install</code></pre>
<ol start="2">
<li>Start the server (<code>Terminal S</code>)</li>
</ol>
<pre><code>bin/postgres -D data</code></pre>
<ol start="3">
<li>Open <code>psql</code> (<code>Terminal C</code>)</li>
</ol>
<pre><code>bin/psql ProjectDB</code></pre>
<h2 id="optional"><a class="header" href="#optional">Optional</a></h2>
<p>You can add <code>$W$/install/bin</code> to your <code>PATH</code> environment variable, so you don't need to go to <code>$W$/install</code> every time to start the server and open <code>psql</code>. To do so:</p>
<ol>
<li>Add <code>$W$/install/bin</code> to <code>~/.bashrc</code>, remember to replace <code>$W$</code> with your actual working directory</li>
</ol>
<pre><code>echo 'export PATH=$W$/install/bin:$PATH' >> ~/.bashrc</code></pre>
<ol start="2">
<li>&quot;Refresh&quot; bash</li>
</ol>
<pre><code>source ~/.bashrc</code></pre>
<p>Then you can start the server at any directory with</p>
<pre><code>postgres -D data</code></pre>
<p>And open the client with</p>
<pre><code>psql ProjectDB</code></pre><div style="break-before: page; page-break-before: always;"></div><h1 id="postgresql-101"><a class="header" href="#postgresql-101">PostgreSQL 101</a></h1>
<p>You are supposed to learn how to use PostgreSQL on you own. Specific SQL grammar (dialect) is not the focus of this course. This tutorial only aims to help you start the labs. The code blocks on this page are aimed for examples, not for copy-and-run. </p>
<h3 id="1-all-sql-in-postgresql-end-with-a-"><a class="header" href="#1-all-sql-in-postgresql-end-with-a-">1. All sql in PostgreSQL end with a &quot;;&quot;</a></h3>
<p><code>psql</code> waits for a <code>;</code>, then it knows it is an end for the sql. To run an SQL, type your sql, end with a <code>;</code> then hit <code>Enter</code>.</p>
<pre><code>ProjectDB=# CREATE TABLE student (sid integer, name text);
CREATE TABLE
ProjectDB=# DROP TABLE student;
DROP TABLE
</code></pre>
<p>This means you can type sql in multiline in <code>psql</code>. Type your sql in multiline, end with a <code>;</code> then hit <code>Enter</code>. When you are in the first line of your sql, line starts with <code>=#</code>; when you are in brackets, line starts with <code>(#</code>, otherwise line starts with <code>-#</code>.</p>
<pre><code>ProjectDB=# CREATE TABLE
ProjectDB-# student
ProjectDB-# (
ProjectDB(# sid integer,
ProjectDB(# name text
ProjectDB(# )
ProjectDB-# ;
CREATE TABLE
</code></pre>
<h3 id="2-helpful-commands-in-psql"><a class="header" href="#2-helpful-commands-in-psql">2. Helpful commands in <code>psql</code></a></h3>
<p>In addition to SQL, <code>psql</code> has many helpful commands.</p>
<ol>
<li>You must exit psql by typing <code>\q</code> and do not use <code>ctrl-c</code>.</li>
</ol>
<pre><code>ProjectDB=# \q
</code></pre>
<ol start="2">
<li>To show relations you have created, use <code>\d</code></li>
</ol>
<pre><code>ProjectDB=# \d
          List of relations
 Schema |  Name   | Type  |  Owner
--------+---------+-------+----------
 public | student | table | huan1531
(1 row)
</code></pre>
<ol start="3">
<li>To show schema of a relation, use <code>\d &lt;relation-name&gt;</code></li>
</ol>
<pre><code>ProjectDB=# \d student
              Table &quot;public.student&quot;
 Column |  Type   | Collation | Nullable | Default
--------+---------+-----------+----------+---------
 sid    | integer |           |          |
 name   | text    |           |          |
</code></pre>
<ol start="4">
<li>To run an sql script located at <code>$W$/script.sql</code>, use <code>\i $W$/script.sql</code></li>
</ol>
<h3 id="3-an-example-sql-script"><a class="header" href="#3-an-example-sql-script">3. An example SQL script</a></h3>
<p>Just like <code>.sh</code> file for shell, <code>.sql</code> file is an executable file for <code>psql</code>, containing one or more sql queries. </p>
<p>Create a new file <code>script.sql</code> in <code>$W$</code>. Copy the following to the file. </p>
<pre><code>/*
 * script.sql
 * A .sql script example
 */

-- Single line comment in .sql file starts with &quot;--&quot;

/*
 * Multiline comment is wrapped by &quot;/&quot; and &quot;*&quot;
 */

-- Drop table if exists
DROP TABLE IF EXISTS student;

-- Create table
CREATE TABLE student (
    sid integer,
    name text
);

-- Insert value into table
INSERT INTO student VALUES (1, 'John');
INSERT INTO student VALUES (2, 'Sam');
INSERT INTO student VALUES (3, 'Mark');
INSERT INTO student VALUES (4, 'Ted');
INSERT INTO student VALUES (5, 'Ross');
INSERT INTO student VALUES (6, 'James');
INSERT INTO student VALUES (7, 'Tom');

-- Do some sample queries
-- 1. Select all from table, '*' return all attributes
SELECT * FROM student;

-- 2. What is Ross's student ID
SELECT sid
FROM student
WHERE name = 'Ross';

-- 3. Who are the students with ID less than 3
select sid from student where sid &lt; 3;
</code></pre>
<blockquote>
<p>As you can tell from the last query, SQL is case insensitive. However, it is always good to follow some style guides, for example this <a href="https://www.sqlstyle.guide/">guide</a>.</p>
</blockquote>
<p>Save the file and go back into <code>psql</code>. To run the script, use <code>\i $W$/script.sql</code>.</p>
<pre><code>ProjectDB=# \i $W$/script.sql
DROP TABLE
CREATE TABLE
INSERT 0 1
INSERT 0 1
INSERT 0 1
INSERT 0 1
INSERT 0 1
INSERT 0 1
INSERT 0 1
 sid | name
-----+-------
   1 | John
   2 | Sam
   3 | Mark
   4 | Ted
   5 | Ross
   6 | James
   7 | Tom
(7 rows)

 sid
-----
   5
(1 row)

 name
------
 John
 Sam
(2 rows)
</code></pre>
<p><code>.sql</code> file can also be passed as an argument to <code>psql</code>, so you can run a <code>.sql</code> file without going into <code>psql</code>. Copy and run following command in your terminal. </p>
<pre><code>bin/psql ProjectDB -f $W$/script.sql</code></pre>
<p>You should see the following output. </p>
<pre><code>$ bin/psql ProjectDB -f $W$/script.sql
DROP TABLE
CREATE TABLE
INSERT 0 1
INSERT 0 1
INSERT 0 1
INSERT 0 1
INSERT 0 1
INSERT 0 1
INSERT 0 1
 sid | name
-----+-------
   1 | John
   2 | Sam
   3 | Mark
   4 | Ted
   5 | Ross
   6 | James
   7 | Tom
(7 rows)

 sid
-----
   5
(1 row)

 name
------
 John
 Sam
(2 rows)
</code></pre>
<h3 id="4-use-online-resources"><a class="header" href="#4-use-online-resources">4. Use online resources</a></h3>
<p>You can find tons of tutorials, Q&amp;As for SQL and PostgreSQL on Internet.</p>
<ul>
<li><a href="https://www.postgresql.org/docs/14/index.html">Official PostgreSQL document</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="troubleshooting"><a class="header" href="#troubleshooting">Troubleshooting</a></h1>
<p>Will keep updating as time goes on. Contributions are welcomed.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="lab-1"><a class="header" href="#lab-1">Lab 1</a></h1>
<blockquote>
<p><i class="trigger fa fa-exclamation-triangle fa-lg"></i>
Do <strong>NOT</strong> post your project on a public Github repository.</p>
</blockquote>
<h2 id="introduction-1"><a class="header" href="#introduction-1">Introduction</a></h2>
<p>You are going to use PostgreSQL, a major open source DMBS, to perform some queries against a predefined database. The schema and sample data of the database are provided. </p>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>In this project, you will create a ProjectDB database. ProjectDB is a database used by a software development company to keep track of its projects. ProjectDB keeps track of the projects, the employees/managers working on the projects including the universities they were graduated from. In particular, in this lab, you will perform the following tasks:</p>
<ol>
<li>Setup the PostgreSQL database. You need to finish <a href="./setup.html">Chapter 3</a> before working on the following tasks. </li>
<li>Create the schema of the ProjectDB database. See <a href="./lab1-1.html">Part 1</a></li>
<li>Perform multiple queries. See <a href="./lab1-2.html">Part 2</a></li>
<li>Perform data updates. See <a href="./lab1-3.html">Part 3</a></li>
</ol>
<h2 id="grading"><a class="header" href="#grading">Grading</a></h2>
<ul>
<li>Part 1: 20 points</li>
<li>Part 2: 60 points</li>
<li>Part 3: 20 points</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="part-1-projectdb-schema-creation"><a class="header" href="#part-1-projectdb-schema-creation">Part 1: ProjectDB Schema Creation</a></h1>
<p>ProjectDB consists of the following relations defined in the following schemas. Please create tables for them in PostgreSQL.</p>
<h4 id="important-update-0208"><a class="header" href="#important-update-0208">Important Update (02/08)</a></h4>
<ul>
<li>Primary keys are underlined for each relation. You need to include them in your <code>CREATE TABLE</code> statements. </li>
<li>Include the following constrain with <code>ON DELETE</code> actions in your <code>CREATE TABLE</code> statements. 
<ul>
<li>When a project is removed from record, we no longer keep records for <code>EmpProject</code> and <code>ProjectManager</code>.</li>
</ul>
</li>
<li>You may find these parts of document useful for this lab
<ul>
<li><a href="https://www.postgresql.org/docs/14/ddl.html">Create table related</a></li>
<li><a href="https://www.postgresql.org/docs/14/queries.html">Query related</a></li>
<li><a href="https://www.postgresql.org/docs/14/dml.html">Insert/delete related</a></li>
</ul>
</li>
</ul>
<blockquote>
<p>University (<br />
  <u>UnivId</u>: NUMERIC<br />
  UnivName: VARCHAR(40)<br />
)</p>
</blockquote>
<blockquote>
<p>Department (<br />
  <u>DeptId</u>: NUMERIC<br />
  DeptName: VARCHAR(40)<br />
)</p>
</blockquote>
<blockquote>
<p>Employee (<br />
  <u>EmpId</u>: NUMERIC<br />
  EmpName: VARCHAR(40)<br />
  DeptId: NUMERIC REFERENCES Department(DeptId)<br />
  HomeZipCode: NUMERIC<br />
)</p>
</blockquote>
<blockquote>
<p>Project (<br />
  <u>ProjId</u>: NUMERIC<br />
  ProjName: VARCHAR(40)<br />
)</p>
</blockquote>
<blockquote>
<p>Graduate (<br />
  <u>EmpId</u>: NUMERIC REFERENCES Employee(EmpId)<br />
  UnivId: NUMERIC REFERENCES University(UnivId)<br />
  GradYear: NUMERIC<br />
)</p>
</blockquote>
<blockquote>
<p>EmpProject (<br />
  <u>EmpId</u>: NUMERIC REFERENCES Employee(EmpId)<br />
  <u>ProjId</u>: NUMERIC REFERENCES Project(ProjId)<br />
)</p>
</blockquote>
<blockquote>
<p>ProjectManager (<br />
  <u>ProjId</u>: NUMERIC REFERENCES Project(ProjId)<br />
  <u>MgrId</u>: NUMERIC REFERENCES Employee(EmpId)<br />
)</p>
</blockquote>
<h2 id="what-to-submit"><a class="header" href="#what-to-submit">What to Submit?</a></h2>
<p>The submission of your work is a file named <code>p1.sql</code>, that contains all SQL queries to create the above relations.</p>
<h2 id="grading-criteria"><a class="header" href="#grading-criteria">Grading Criteria:</a></h2>
<ul>
<li>Total: 20 points
<ul>
<li>10 Points: The provided script is able to create all the above relations with the correct schema.</li>
<li>10 Points: The provided script handles the FOREIGN KEY constraint perfectly.</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="part-2-sql-queries"><a class="header" href="#part-2-sql-queries">Part 2: SQL Queries</a></h1>
<p>Once you have created the above schemas, you need to load some data to the relations. </p>
<p>Download <a href="./resource/data.sql"><code>data.sql</code></a> with this command:</p>
<pre><code>wget https://csci4707-umn.github.io/lab-book/resource/lab1/data.sql</code></pre>
<p>Run the <code>data.sql</code> file to load the data into the database. In <code>psql</code>:</p>
<pre><code>\i &#60;path-to-data.sql&#62;</code></pre>
<p>Then, write SQL queries that answer the questions below (one SQL query per question but you are allowed to use nested queries). The query answers should be duplicate-free, but you should use distinct only when necessary.</p>
<ol>
<li>
<p>Find the names of the employees who are living in Minneapolis (Zip code 55414 or 55455).</p>
</li>
<li>
<p>Find the names of the projects that are currently managed by any manager.</p>
</li>
<li>
<p>For each project, display its name as well as the number of employees who are currently working on it except for a project without any employees.</p>
</li>
<li>
<p>Find the name(s) of the university/universities that graduated the maximum number of distinct managers.</p>
</li>
<li>
<p>For each employee, say E, display the name of E, the department name of E, and the graduation year of E.</p>
</li>
<li>
<p>Display the name of the project that has the maximum number of different employees who worked/&quot;are working&quot; on it. If more than one project qualify, display all the qualified projects. (Hint: refer to EmpProject only and not ProjectManager).</p>
</li>
</ol>
<h2 id="what-to-submit-1"><a class="header" href="#what-to-submit-1">What to Submit?</a></h2>
<p>The submission of your work is a file named <code>p2.sql</code>, that contains all the above SQL queries.</p>
<h2 id="grading-criteria-1"><a class="header" href="#grading-criteria-1">Grading Criteria:</a></h2>
<ul>
<li>10 Points (no partial credit) for each correct SQL query.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="part-3-sql-updates-and-deletes"><a class="header" href="#part-3-sql-updates-and-deletes">Part 3: SQL Updates and Deletes</a></h1>
<ol>
<li>
<p>Employee with Id 2 has moved to an address in 55414. Please update this in the database and select that employee after the update to ensure that the corresponding tuple has been updated.</p>
</li>
<li>
<p>Just as a practical joke, increment the graduation year of every graduate who graduated before 2002 by three.</p>
</li>
<li>
<p>Just another practical joke, decrement the graduation year of every graduate who lives in 55414 by two.</p>
</li>
<li>
<p>For some reasons, the database owner wants to get rid of everything related to the project with Id 2. Please delete all the tuples related to Project 2 (as if that project has never existed before).</p>
</li>
</ol>
<h2 id="what-to-submit-2"><a class="header" href="#what-to-submit-2">What to Submit?</a></h2>
<p>The submission of your work is a file named <code>p3.sql</code>, that contains all the above SQL queries.</p>
<h2 id="grading-criteria-2"><a class="header" href="#grading-criteria-2">Grading Criteria:</a></h2>
<ul>
<li>5 Points (no partial credit) for each correct SQL query.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="important-updates"><a class="header" href="#important-updates">Important updates</a></h1>
<p>Please make sure you have followed the updates before submit your work. </p>
<p>Ordered by date</p>
<ul>
<li><a href="./lab1-1.html#important-update-0208">02/08</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="lab-1-submit-guidance"><a class="header" href="#lab-1-submit-guidance">Lab 1 Submit Guidance</a></h1>
<blockquote>
<p><i class="trigger fa fa-exclamation-triangle fa-lg"></i>
Do <strong>NOT</strong> post your project on a public Github repository.</p>
</blockquote>
<blockquote>
<p>Please make sure you have followed the updates before submit your work. </p>
<p>Ordered by date</p>
<ul>
<li><a href="./lab1-1.html#important-update-0208">02/08</a></li>
</ul>
</blockquote>
<p><strong>Only one</strong> submission is needed for group work. Please include everyone’s name and ID in a <code>README.txt</code> file.</p>
<p>The <code>README.txt</code> file should use the following template, where ID is your <code>x.500</code> ID.</p>
<pre><code>Student 1
Name:
ID: 

Student 2
Name:
ID: 

Student 3
Name:
ID: 
</code></pre>
<p>Zip all four files (<code>p1.sql</code> <code>p2.sql</code> <code>p3.sql</code> and <code>README.txt</code>) into one zip file with the following command. You need to have all four files in the same directory and run the command in that directory. Remember to replace <code>&lt;x.500&gt;</code> with your <code>x.500</code> ID. This ID can be anyone who submits the work for the group. </p>
<pre><code>zip &#60;x.500&#62;.zip README.txt p1.sql p2.sql p3.sql</code></pre>
<p>This command generates a zip file named <code>&lt;x.500&gt;.zip</code>. Submit this file to Gradescope. </p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="lab-2"><a class="header" href="#lab-2">Lab 2</a></h1>
<blockquote>
<p><i class="trigger fa fa-exclamation-triangle fa-lg"></i>
Do <strong>NOT</strong> post your project on a public Github repository.</p>
</blockquote>
<h2 id="introduction-2"><a class="header" href="#introduction-2">Introduction</a></h2>
<p>You are going to change the buffer replacement policy that is currently used in PostgreSQL. In particular, the original replacement policy of PostgreSQL is a &quot;clock sweep&quot; algorithm with LRU (Least Recently Used). In this lab, you are asked to implement an <strong>MRU</strong> (Most Recently Used) replacement policy without using the &quot;clock sweep&quot; algorithm.</p>
<h2 id="outline"><a class="header" href="#outline">Outline</a></h2>
<p>In this lab, you need to:</p>
<ol>
<li>Set up PostgreSQL: Same as in Lab 1. If you correctly set up PostgreSQL in Lab1, you are safe to skip this section. See <a href="./setup.html">Chapter 3</a> if you need to re-install. </li>
<li><strong>(Due Mar 29)</strong> Understand MRU, go through the related code and answer the questions. See <a href="./lab2-0.html">5.1</a>.</li>
<li>Implement MRU within PostgreSQL. See <a href="./lab2-1.html">5.2</a>.</li>
<li>Compile and test your changes. See <a href="./lab2-2.html">5.3</a>.</li>
</ol>
<h2 id="grading-1"><a class="header" href="#grading-1">Grading</a></h2>
<ul>
<li>15 Points <strong>(Due Mar 29)</strong>: Answer the questions on Gradescope. See <a href="./lab2-0.html">5.1</a> for grading detail. </li>
<li>20 Points: Your changes must be able to compile without any errors.</li>
<li>35 Points: The MRU replacement policy including incorporating the printing instructions.</li>
<li>30 Points: The quality of your solution.txt.</li>
</ul>
<h2 id="note"><a class="header" href="#note">Note</a></h2>
<p>Since reading and understanding an open-source framework is the main goal of the lab, the TA is only allowed to do the following: </p>
<ul>
<li>Help you with the installation of PostgreSQL. </li>
<li>Help you in understanding the concept of buffer management policy. </li>
<li>Help you in understanding what the assignment wants you to do. </li>
</ul>
<p>Unfortunately, the TA is not allowed to help you in navigating the source code (including telling you the functionality of a function or variables) since one of the goals of the lab is to make sure that you understand the source code of the buffer manager in PostgreSQL. Once you understand the source code and know where to make the change, it is very easy to solve the lab.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="part-1-understand-mru-and-code"><a class="header" href="#part-1-understand-mru-and-code">Part 1: Understand MRU and Code</a></h1>
<h2 id="mru"><a class="header" href="#mru">MRU</a></h2>
<p>The basic idea of MRU can be seen in <a href="https://en.wikipedia.org/wiki/Cache_replacement_policies#Most_recently_used_(MRU)">here</a>. However, you will need to adapt the algorithm with the database buffer management policy concept. </p>
<h2 id="implement-mru-in-postgresql"><a class="header" href="#implement-mru-in-postgresql">Implement MRU in PostgreSQL</a></h2>
<p>Most (if not all) of your changes will be located in the directory: <code>$W$/postgresql-14.1/src/backend/storage/buffer/</code>. </p>
<p>To implement the MRU algorithm, you will want to maintain the timestamp of each buffer when they are &quot;used&quot;. For simplicity, you will maintain a global integer value which will be assigned to a buffer whenever a buffer page is &quot;used&quot;, then, increment the integer. Initially, all buffers will have zero timestamp.</p>
<p>When you need to replace a buffer, you scan the buffers, determine the candidate (not in use) buffers and evict the one with the most recent timestamp. </p>
<h2 id="questions-15-pts"><a class="header" href="#questions-15-pts">Questions (15 pts)</a></h2>
<p>These questions are designed to let you start early and guide you through the codebase. Answer the following questions on Gradescope. This work is due on <strong>Mar 29</strong>.</p>
<p>Please answer the following questions based on the original code of PostgreSQL 14.1:</p>
<ol>
<li>There are five files under <code>$W$/postgresql-14.1/src/backend/storage/buffer/</code>. What is each file's job? Answer for each file in one sentence. (5 pts)</li>
</ol>
<ul>
<li>buf_init.c</li>
<li>buf_table.c</li>
<li>bufmgr.c</li>
<li>freelist.c</li>
<li>localbuf.c</li>
</ul>
<ol start="2">
<li>
<p>What is the original buffer replacement policy/algorithm for PostgreSQL? In which file? In which function? From which line to which line? (4 pts)</p>
</li>
<li>
<p>Which part of PostgreSQL code defines the concept &quot;buffer&quot;? In which file? By which class? (2 pts)</p>
</li>
<li>
<p>Where does PostgreSQL &quot;initialize&quot; each buffer? In which file? In which function? (2 pts)</p>
</li>
<li>
<p>Where does PostgreSQL &quot;use&quot; each buffer? In which file? In which function? (2 pts)</p>
</li>
</ol>
<h2 id="submitting-and-grading"><a class="header" href="#submitting-and-grading">Submitting and Grading</a></h2>
<p>This work is due on <strong>Mar 29</strong>, about half way through the whole lab. Only <strong>one</strong> submission is needed for each group. </p>
<p>You will get all 15 points if you answer all the questions, regardless their correctness. </p>
<p>The TA will not give you the correct answer. Instead, the TA will give you correct/wrong feedback. Again, the major goal of the lab is to train your ability to work on (hack into) a real DBMS system, so the TA is not allowed to help you in navigating the source code. </p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="part-2-implement-mru"><a class="header" href="#part-2-implement-mru">Part 2: Implement MRU</a></h1>
<h2 id="implement-mru-in-postgresql-1"><a class="header" href="#implement-mru-in-postgresql-1">Implement MRU in PostgreSQL</a></h2>
<p>Most (if not all) of your changes will be located in the directory: <code>$W$/postgresql-14.1/src/backend/storage/buffer/</code>. </p>
<p>To implement the MRU algorithm, you will want to maintain the timestamp of each buffer when they are &quot;used&quot;. For simplicity, you will maintain a global integer value which will be assigned to a buffer whenever a buffer page is &quot;used&quot;, then, increment the integer. Initially, all buffers will have zero timestamp.</p>
<p>When you need to replace a buffer, you scan through the buffers, determine the candidate (not in use) buffers and evict the one with the most recent timestamp. </p>
<h2 id="print-out-log"><a class="header" href="#print-out-log">Print out log</a></h2>
<p>To verify the correctness of your implementation, you need to print out the timestamp of all candidates (not in use) buffers as: </p>
<p><code>Candidate buffers: &lt;a comma separated list of timestamps&gt;</code></p>
<p>and also explicitly print out the timestamp of the buffer that is going to be replaced as:</p>
<p><code>Replaced buffer: &lt;timestamp&gt;</code></p>
<p>An example of expected output is shown below. Please note that your output may have different timestamps, different amount of candidates for each replacement. That is possible. 
<img src="./figure/mru.png" alt="mru" /></p>
<p>You can print out the log with the <code>printf</code> function in C programming language. It will print in your <strong>server terminal</strong>. </p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="part-3-compile-and-test"><a class="header" href="#part-3-compile-and-test">Part 3: Compile and Test</a></h1>
<h2 id="change-postgresql-config"><a class="header" href="#change-postgresql-config">Change PostgreSQL config</a></h2>
<p>To test your changes, you first need to change the memory size of PostgreSQL. Since the test case given to you is very small compared to the default memory size of PostgreSQL, it is a good idea to config the memory to a smaller size. </p>
<p>The configuration is located in: <code>$W$/install/data/postgresql.conf</code>. You need to change the <strong>shared_buffer</strong> size to <strong>shared_buffers = 128kB</strong>.</p>
<h2 id="compile-your-changes"><a class="header" href="#compile-your-changes">Compile your changes</a></h2>
<p>To compile your changes, you must run the following three commands from the source directory, i.e., <code>$W$/postgresql-14.1</code>. Remember to shutdown your server before you make a new compiling:</p>
<ol>
<li>Clean previous make.</li>
</ol>
<pre><code>make clean</code></pre>
<ol start="2">
<li>Make.</li>
</ol>
<pre><code>make</code></pre>
<ol start="3">
<li>Install the changes. </li>
</ol>
<pre><code>make install</code></pre>
<p>If you get no error in this process, you will be able to start and server and client and test your changes. </p>
<h2 id="test-your-changes"><a class="header" href="#test-your-changes">Test your changes</a></h2>
<p>You need two files to run the test:</p>
<ul>
<li><code>values10k.dat</code>: contains the data to be inserted into PostgreSQL.</li>
<li><code>buffer_add.sql</code>: contains the sql to do the insertion.</li>
</ul>
<p>Download these two files to somewhere with following commands:</p>
<pre><code>wget https://csci4707-umn.github.io/lab-book/resource/lab2/values10k.dat && wget https://csci4707-umn.github.io/lab-book/resource/lab2/buffer_add.sql</code></pre>
<p>You will test your change by inserting data into the database and looking at the replaced buffer’s timestamp compared to all other candidate buffers’ timestamp. </p>
<p>To insert the data to the database, you need:</p>
<ol>
<li>In <code>buffer_add.sql</code>, update the <code>&lt;PATH_TO_values10k.dat&gt;</code> to the real path to <code>values10k.dat</code> on your test machine. </li>
<li>Start the server and the <code>psql</code>.</li>
<li>In <code>psql</code>, execute <code>buffer_add.sql</code> with following command. Remember to replace <code>&lt;PATH_TO_buffer_add.sql&gt;</code> to the real path to <code>buffer_add.sql</code> on your test machine. </li>
</ol>
<pre><code>\i  &#60;PATH_TO_buffer_add.sql &#62;</code></pre>
<p>An example of running the test is shown below. The terminal on the right is the server terminal and the terminal on the left is the client terminal. 
<img src="./figure/mru-test.png" alt="mru-test" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="submit-guidance"><a class="header" href="#submit-guidance">Submit Guidance</a></h1>
<blockquote>
<p><i class="trigger fa fa-exclamation-triangle fa-lg"></i>
Do <strong>NOT</strong> post your project on a public Github repository.</p>
</blockquote>
<p>Remember this lab has <strong>two</strong> dues:</p>
<ul>
<li>Phase 1 (Due Mar 29): Answer the questions on Gradescope.</li>
<li>Phase 2 (Due Apr 14): Submit you implementation. There will be a 10% penalty off your grade for a 24-hour late submission.</li>
</ul>
<h2 id="phase-1-submission-due-mar-29"><a class="header" href="#phase-1-submission-due-mar-29">Phase 1 submission (Due Mar 29)</a></h2>
<p>See <a href="./lab2-0.html#submitting-and-grading">5.1</a></p>
<h2 id="phase-2-submission-due-apr-14"><a class="header" href="#phase-2-submission-due-apr-14">Phase 2 submission (Due Apr 14)</a></h2>
<p><strong>Only one</strong> submission is needed for group work. </p>
<p>You must submit a zip file named <code>&lt;x.500&gt;.zip</code>. Your zip file should unzip to a following structure:</p>
<pre><code>&lt;x.500&gt;/
├── solution.txt
└── changes
    ├── foo.c
    ├── bar.c
    ├── ...
    └── foo.h
</code></pre>
<ol>
<li><code>changes</code>: A folder that contains all files that you have changed in order to fulfill the lab. Please only submit the file itself (don’t include the directory). For example: if you change a file in <code>src/backend/foo.c</code>, only put <code>foo.c</code> in the folder.</li>
<li><code>solution.txt</code>: Modify the solution.txt template below as per your changes. List all group members at the very beginning of this file. </li>
</ol>
<pre><code>Students:
1. &lt;Student 1 Full Name&gt; (&lt;Student 1 x500&gt;)
2. &lt;Student 2 Full Name&gt; (&lt;Student 2 x500&gt;)
2. &lt;Student 3 Full Name&gt; (&lt;Student 3 x500&gt;)

Brief Summary:
&lt;A Brief Summary about the change you make (1 Paragraph max)&gt;

Detailed Changes:
1. &lt;Modified File 1&gt;: &lt;The path of the modified file from src directory&gt;
	- &lt;Detailed changes of the file&gt;.
	For example: In line xxx, I make a change so that the buffer will do ......
	
2. &lt;Modified File 2&gt;: &lt;Path from src&gt;
	- &lt;Detailed changes of the file&gt;.
</code></pre>
<p>Each violation to the submission guideline will result in a <strong>10%</strong> penalty.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="lab-3"><a class="header" href="#lab-3">Lab 3</a></h1>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->

        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </body>
</html>
